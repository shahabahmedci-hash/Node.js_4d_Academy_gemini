<div class="dashboard-header">
    <h1>Welcome, Admin!</h1>
    <p>A quick summary of the 4D Academy's current status.</p>
</div>

<div class="summary-cards" style="display: flex; gap: 20px; margin-top: 30px;">
    <div class="card" style="flex: 1; padding: 20px; background: var(--color-surface); border-radius: 8px; box-shadow: var(--color-shadow);">
        <h3>Total Students</h3>
        <p style="font-size: 2em; color: var(--color-primary); margin-top: 10px;">{{analytics.totalStudents}}</p>
    </div>

    <div class="card" style="flex: 1; padding: 20px; background: var(--color-surface); border-radius: 8px; box-shadow: var(--color-shadow);">
        <h3>Fees Paid (Pending)</h3>
        <p style="font-size: 2em; color: var(--color-success); margin-top: 10px;">{{analytics.paidFeesCount}}</p>
    </div>

    <div class="card" style="flex: 1; padding: 20px; background: var(--color-surface); border-radius: 8px; box-shadow: var(--color-shadow);">
        <h3>Fees Unpaid</h3>
        <p style="font-size: 2em; color: var(--color-error); margin-top: 10px;">{{analytics.unpaidFeesCount}}</p>
    </div>

    <div class="card" style="flex: 1; padding: 20px; background: var(--color-surface); border-radius: 8px; box-shadow: var(--color-shadow);">
        <h3>Last Month Income</h3>
        <p style="font-size: 2em; color: var(--color-text); margin-top: 10px;">₹ {{analytics.lastMonthIncome}}</p>
    </div>
</div>

<div class="chart-area" style="margin-top: 40px; background: var(--color-surface); padding: 30px; border-radius: 12px; box-shadow: var(--color-shadow);">
    <h2>Monthly Financial Overview</h2>
    <canvas id="financeChart" width="800" height="400"></canvas>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // 1. Get data passed from the server router
    const rawData = document.getElementById('financeChart').closest('.chart-area').dataset.chartData;
    const monthlyReports = JSON.parse(rawData || '[]');

    const labels = monthlyReports.map(r => r.month);
    const incomeData = monthlyReports.map(r => r.income);
    const expenseData = monthlyReports.map(r => r.expense);
    
    // 2. Configure and render Chart.js
    const ctx = document.getElementById('financeChart').getContext('2d');
    
    new Chart(ctx, {
        type: 'bar', // Using bar chart for financial comparison
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Income (₹)',
                    data: incomeData,
                    backgroundColor: 'rgba(40, 167, 69, 0.7)', // Success green
                    borderColor: 'rgba(40, 167, 69, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Expenses (₹)',
                    data: expenseData,
                    backgroundColor: 'rgba(220, 53, 69, 0.7)', // Error red
                    borderColor: 'rgba(220, 53, 69, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Monthly Income vs. Expenses'
                }
            }
        }
    });
});
</script>
